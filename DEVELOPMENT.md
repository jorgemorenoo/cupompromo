# Guia de Desenvolvimento - Cupompromo

Este documento cont√©m informa√ß√µes importantes para desenvolvedores que trabalham no plugin Cupompromo.

## üöÄ Configura√ß√£o do Ambiente

### Requisitos
- PHP 8.1 ou superior
- WordPress 5.0 ou superior
- MySQL 5.7 ou superior
- Composer
- Node.js (para assets)

### Instala√ß√£o

1. **Clone o reposit√≥rio**
   ```bash
   git clone https://github.com/seu-usuario/cupompromo.git
   cd cupompromo
   ```

2. **Instale as depend√™ncias**
   ```bash
   composer install
   ```

3. **Configure o ambiente de desenvolvimento**
   ```bash
   cp config-dev.php wp-content/plugins/cupompromo/
   ```

4. **Ative o plugin no WordPress**
   - Acesse o painel administrativo
   - V√° em Plugins > Plugins Instalados
   - Ative o plugin "Cupompromo"

## üìÅ Estrutura do Projeto

```
cupompromo/
‚îú‚îÄ‚îÄ cupompromo.php                 # Arquivo principal
‚îú‚îÄ‚îÄ includes/                       # Classes principais
‚îÇ   ‚îú‚îÄ‚îÄ class-cupompromo.php       # Classe principal
‚îÇ   ‚îú‚îÄ‚îÄ class-post-types.php       # CPTs e taxonomias
‚îÇ   ‚îú‚îÄ‚îÄ class-admin.php            # Interface administrativa
‚îÇ   ‚îú‚îÄ‚îÄ class-frontend.php         # Funcionalidades frontend
‚îÇ   ‚îú‚îÄ‚îÄ class-api.php              # Endpoints REST API
‚îÇ   ‚îú‚îÄ‚îÄ class-shortcodes.php       # Shortcodes
‚îÇ   ‚îú‚îÄ‚îÄ class-gutenberg.php        # Blocos Gutenberg
‚îÇ   ‚îî‚îÄ‚îÄ class-analytics.php        # Analytics e tracking
‚îú‚îÄ‚îÄ admin/                         # √Årea administrativa
‚îÇ   ‚îú‚îÄ‚îÄ views/                     # Templates admin
‚îÇ   ‚îú‚îÄ‚îÄ css/                       # Estilos admin
‚îÇ   ‚îî‚îÄ‚îÄ js/                        # Scripts admin
‚îú‚îÄ‚îÄ public/                        # Frontend
‚îÇ   ‚îú‚îÄ‚îÄ css/                       # Estilos frontend
‚îÇ   ‚îú‚îÄ‚îÄ js/                        # Scripts frontend
‚îÇ   ‚îî‚îÄ‚îÄ images/                    # Assets
‚îú‚îÄ‚îÄ templates/                     # Templates personalizados
‚îú‚îÄ‚îÄ blocks/                        # Blocos Gutenberg
‚îú‚îÄ‚îÄ languages/                     # Tradu√ß√µes
‚îú‚îÄ‚îÄ tests/                         # Testes unit√°rios
‚îú‚îÄ‚îÄ assets/                        # Arquivos fonte
‚îî‚îÄ‚îÄ docs/                          # Documenta√ß√£o
```

## üß™ Testes

### Executar Testes
```bash
# Todos os testes
composer run test

# Com cobertura
composer run test:coverage

# Testes espec√≠ficos
vendor/bin/phpunit tests/Unit/
vendor/bin/phpunit tests/Integration/
```

### Configura√ß√£o do PHPUnit
O arquivo `phpunit.xml` est√° configurado para:
- Usar o WordPress Test Suite
- Gerar relat√≥rios de cobertura
- Excluir arquivos desnecess√°rios

## üîß Qualidade de C√≥digo

### PHP_CodeSniffer
```bash
# Verificar c√≥digo
composer run lint

# Corrigir automaticamente
composer run fix
```

### Padr√µes de C√≥digo
- WordPress Coding Standards
- PSR-12 para estrutura
- PHP 8.1+ com tipagem estrita
- Coment√°rios PHPDoc obrigat√≥rios

## üìä Analytics e Logs

### Configura√ß√£o de Logs
```php
// Habilitar logs detalhados
define('CUPOMPROMO_DETAILED_LOGGING', true);
define('CUPOMPROMO_LOG_QUERIES', true);
```

### Visualizar Logs
```bash
# Logs de debug
tail -f wp-content/logs/cupompromo-debug.log

# Logs de erro
tail -f wp-content/logs/cupompromo-errors.log
```

## üîå APIs e Integra√ß√µes

### REST API
- Base URL: `/wp-json/cupompromo/v1/`
- Endpoints dispon√≠veis:
  - `GET /coupons` - Listar cupons
  - `GET /stores` - Listar lojas
  - `POST /validate-coupon` - Validar cupom
  - `POST /analytics` - Registrar analytics

### Exemplo de Uso
```php
// Buscar cupons
$response = wp_remote_get(home_url('/wp-json/cupompromo/v1/coupons'));

// Validar cupom
$response = wp_remote_post(home_url('/wp-json/cupompromo/v1/validate-coupon'), [
    'body' => [
        'coupon_code' => 'DESCONTO10'
    ]
]);
```

## üé® Frontend

### Componentes Reutiliz√°veis

#### Cupompromo_Store_Card
```php
// Uso b√°sico
$store_card = new Cupompromo_Store_Card($store_data);
echo $store_card->render();

// Modo minimalista
echo $store_card->render_minimal();

// Modo destaque
echo $store_card->render_featured();

// Modo compacto
echo $store_card->render_compact();

// Configura√ß√µes personalizadas
$config = array(
    'show_logo' => true,
    'show_description' => false,
    'card_style' => 'featured',
    'logo_size' => 'large',
    'animation' => true
);
$store_card->set_config($config);
echo $store_card->render();
```

### Shortcodes Dispon√≠veis
```php
[cupompromo_search]                    // Formul√°rio de busca
[cupompromo_stores_grid]               // Grid de lojas
[cupompromo_popular_coupons]           // Cupons populares
[cupompromo_coupons_by_category]       // Cupons por categoria
[cupompromo_featured_stores]           // Lojas em destaque
[cupompromo_coupon_form]               // Formul√°rio de cupom
```

### Blocos Gutenberg
- `cupompromo/stores-grid` - Grid de lojas
- `cupompromo/coupons-list` - Lista de cupons
- `cupompromo/search-bar` - Barra de busca
- `cupompromo/featured-carousel` - Carrossel

## üóÑÔ∏è Banco de Dados

### Tabelas Principais
```sql
-- Lojas
wp_cupompromo_stores

-- Cupons
wp_cupompromo_coupons

-- Categorias
wp_cupompromo_categories

-- Relacionamento cupons-categorias
wp_cupompromo_coupon_categories

-- Analytics
wp_cupompromo_analytics
```

### Migra√ß√µes
```bash
# Ativar plugin (cria tabelas)
wp plugin activate cupompromo

# Desativar plugin (remove dados se configurado)
wp plugin deactivate cupompromo
```

## üîí Seguran√ßa

### Boas Pr√°ticas
- Sempre use `wp_verify_nonce()` para formul√°rios
- Sanitize todas as entradas com `sanitize_text_field()`
- Escape todas as sa√≠das com `esc_html()`
- Use prepared statements para queries
- Verifique permiss√µes com `current_user_can()`

### Exemplo
```php
// Verificar nonce
if (!wp_verify_nonce($_POST['nonce'], 'cupompromo_action')) {
    wp_die(__('Erro de seguran√ßa.', 'cupompromo'));
}

// Sanitizar entrada
$coupon_code = sanitize_text_field($_POST['coupon_code']);

// Verificar permiss√µes
if (!current_user_can('manage_options')) {
    wp_die(__('Permiss√£o negada.', 'cupompromo'));
}

// Escape sa√≠da
echo esc_html($coupon->title);
```

## üöÄ Performance

### Cache
```php
// Usar transients para cache
$cached_data = get_transient('cupompromo_popular_coupons');
if (false === $cached_data) {
    $cached_data = $this->get_popular_coupons();
    set_transient('cupompromo_popular_coupons', $cached_data, HOUR_IN_SECONDS);
}
```

### Otimiza√ß√£o de Queries
```php
// Usar prepared statements
$coupons = $wpdb->get_results($wpdb->prepare(
    "SELECT * FROM {$wpdb->prefix}cupompromo_coupons WHERE status = %s",
    'active'
));
```

## üìù Internacionaliza√ß√£o

### Textos Traduz√≠veis
```php
// Usar __() para strings simples
echo __('Cupom v√°lido!', 'cupompromo');

// Usar _e() para strings que s√£o exibidas
_e('Erro ao salvar cupom.', 'cupompromo');

// Usar sprintf() para strings com vari√°veis
echo sprintf(
    __('Cupom %s aplicado com sucesso!', 'cupompromo'),
    esc_html($coupon_code)
);
```

### Gerar Arquivo POT
```bash
# Extrair strings traduz√≠veis
wp i18n make-pot . languages/cupompromo.pot
```

## üîÑ Versionamento

### Commits
- Use mensagens descritivas
- Siga o padr√£o Conventional Commits
- Referencie issues quando relevante

```bash
git commit -m "feat: adiciona valida√ß√£o de cupons expirados

- Implementa verifica√ß√£o de data de expira√ß√£o
- Adiciona testes unit√°rios
- Atualiza documenta√ß√£o

Closes #123"
```

### Tags
```bash
# Criar tag de vers√£o
git tag -a v1.0.0 -m "Vers√£o 1.0.0"

# Push da tag
git push origin v1.0.0
```

## üêõ Debug

### Habilitar Debug
```php
// No wp-config.php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('CUPOMPROMO_DEBUG', true);
```

### Logs Personalizados
```php
// Logar informa√ß√µes
error_log('Cupompromo: ' . $message);

// Logar arrays/objetos
error_log('Cupompromo: ' . print_r($data, true));
```

## üìö Recursos Adicionais

### Documenta√ß√£o
- [WordPress Plugin Handbook](https://developer.wordpress.org/plugins/)
- [WordPress Coding Standards](https://developer.wordpress.org/coding-standards/)
- [PHP 8.1 Documentation](https://www.php.net/manual/en/)

### Ferramentas √öteis
- [Query Monitor](https://wordpress.org/plugins/query-monitor/) - Debug de queries
- [Debug Bar](https://wordpress.org/plugins/debug-bar/) - Debug geral
- [Log Deprecated Notices](https://wordpress.org/plugins/log-deprecated-notices/) - Log de fun√ß√µes deprecated

### Comunidade
- [WordPress.org Forums](https://wordpress.org/support/)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/wordpress)
- [WordPress Slack](https://make.wordpress.org/chat/)

---

**Lembre-se**: Sempre teste suas altera√ß√µes antes de fazer commit e mantenha o c√≥digo limpo e bem documentado! üöÄ 

##  **Relat√≥rio de Conformidade com as Regras do Projeto**

### ‚úÖ **Pontos Positivos - O que est√° de acordo:**

1. **Estrutura e Arquitetura**
   - ‚úÖ Uso de `declare(strict_types=1);` em todas as classes
   - ‚úÖ Preven√ß√£o de acesso direto com `!defined('ABSPATH')`
   - ‚úÖ Nomenclatura consistente com prefixo `cupompromo_`
   - ‚úÖ Estrutura de classes bem organizada
   - ‚úÖ Uso de hooks WordPress (actions/filters)

2. **Seguran√ßa**
   - ‚úÖ Verifica√ß√£o de nonces em AJAX
   - ‚úÖ Sanitiza√ß√£o de entradas com `sanitize_text_field()`
   - ‚úÖ Escape de sa√≠das com `esc_html()`
   - ‚úÖ Verifica√ß√£o de permiss√µes com `current_user_can()`

3. **Funcionalidades Core**
   - ‚úÖ Custom Post Types implementados
   - ‚úÖ REST API endpoints funcionais
   - ‚úÖ Sistema de analytics b√°sico
   - ‚úÖ Integra√ß√£o com Awin API
   - ‚úÖ Shortcodes implementados

### ‚ö†Ô∏è **Problemas Identificados:**

1. **Padr√µes de C√≥digo**
   - ‚ùå N√£o segue PSR-12 completamente (espa√ßamento, nomenclatura)
   - ‚ùå Falta de namespaces
   - ‚ùå Alguns m√©todos n√£o seguem camelCase

2. **Estrutura de Arquivos**
   - ‚ùå Falta de assets CSS/JS compilados
   - ‚ùå Blocos Gutenberg incompletos
   - ‚ùå Templates frontend limitados

## üöß **O que precisa ser desenvolvido:**

### **1. PRIORIDADE ALTA - Frontend Completo**

#### Templates Faltantes:
```php
// templates/archive-cupompromo_coupon.php
// templates/taxonomy-cupompromo_category.php  
// templates/search-cupompromo.php
// templates/parts/coupon-card.php
// templates/parts/store-card.php
// templates/parts/search-form.php
```

#### Componentes React:
```javascript
// assets/js/components/CouponModal.js
// assets/js/components/SearchBar.js
// assets/js/components/FilterPanel.js
// assets/js/components/CouponGrid.js
```

### **2. PRIORIDADE ALTA - Blocos Gutenberg Completos**

#### Blocos React:
```bash
# Criar blocos usando @wordpress/create-block
npx @wordpress/create-block cupompromo-stores-grid
npx @wordpress/create-block cupompromo-coupons-list
npx @wordpress/create-block cupompromo-search-bar
npx @wordpress/create-block cupompromo-featured-carousel
```

#### Estrutura dos Blocos:
```javascript
// blocks/stores-grid/src/index.js
// blocks/coupons-list/src/index.js
// blocks/search-bar/src/index.js
// blocks/featured-carousel/src/index.js
```

### **3. PRIORIDADE M√âDIA - Assets e Estilos**

#### CSS/SCSS:
```scss
// assets/scss/frontend/
// ‚îú‚îÄ‚îÄ _variables.scss
// ‚îú‚îÄ‚îÄ _mixins.scss
// ‚îú‚îÄ‚îÄ _components.scss
// ‚îú‚îÄ‚îÄ _layout.scss
// ‚îî‚îÄ‚îÄ main.scss

// assets/scss/admin/
// ‚îú‚îÄ‚îÄ _dashboard.scss
// ‚îú‚îÄ‚îÄ _forms.scss
// ‚îî‚îÄ‚îÄ main.scss
```

#### JavaScript:
```javascript
// assets/js/frontend/
// ‚îú‚îÄ‚îÄ components/
// ‚îú‚îÄ‚îÄ utils/
// ‚îî‚îÄ‚îÄ main.js

// assets/js/admin/
// ‚îú‚îÄ‚îÄ dashboard.js
// ‚îú‚îÄ‚îÄ analytics.js
// ‚îî‚îÄ‚îÄ main.js
```

### **4. PRIORIDADE M√âDIA - Funcionalidades Avan√ßadas**

#### Sistema de Cache:
```php
// includes/class-cache.php
class Cupompromo_Cache {
    public function cache_coupons($store_id, $data);
    public function cache_stores($data);
    public function invalidate_cache($type);
}
```

#### Sistema de Notifica√ß√µes:
```php
// includes/class-notifications.php
class Cupompromo_Notifications {
    public function send_coupon_alert($user_id, $coupon);
    public function send_store_update($user_id, $store);
}
```

### **5. PRIORIDADE BAIXA - Melhorias e Otimiza√ß√µes**

#### Gamifica√ß√£o:
```php
// includes/class-gamification.php
class Cupompromo_Gamification {
    public function get_user_level($user_id);
    public function award_points($user_id, $action);
    public function get_leaderboard();
}
```

#### Analytics Avan√ßado:
```php
// includes/class-advanced-analytics.php
class Cupompromo_Advanced_Analytics {
    public function generate_heatmap();
    public function track_conversions();
    public function calculate_roi();
}
```

## üéØ **Plano de Desenvolvimento Recomendado:**

### **Fase 1 (1-2 semanas): Frontend Core**
1. Criar templates de arquivo e categoria
2. Implementar componentes React b√°sicos
3. Desenvolver sistema de busca
4. Criar modal de cupons

### **Fase 2 (1-2 semanas): Blocos Gutenberg**
1. Configurar @wordpress/create-block
2. Desenvolver blocos React
3. Implementar renderiza√ß√£o server-side
4. Testar integra√ß√£o com editor

### **Fase 3 (1 semana): Assets e Estilos**
1. Configurar build system (webpack/vite)
2. Desenvolver CSS/SCSS
3. Otimizar JavaScript
4. Implementar lazy loading

### **Fase 4 (1 semana): Funcionalidades Avan√ßadas**
1. Sistema de cache
2. Notifica√ß√µes
3. Analytics avan√ßado
4. Gamifica√ß√£o

## Ô∏è **Pr√≥ximos Passos Imediatos:**

1. **Corrigir padr√µes de c√≥digo** (PSR-12)
2. **Criar estrutura de assets** (CSS/JS)
3. **Implementar templates frontend** b√°sicos
4. **Configurar build system** para blocos Gutenberg

Quer que eu comece implementando alguma dessas funcionalidades espec√≠ficas? Posso come√ßar com os templates frontend ou a configura√ß√£o dos blocos Gutenberg. 